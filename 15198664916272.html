<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  机器学习实战之决策树 - Time渐行渐远
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Time渐行渐远" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:dmlcoding.com ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="collections.html">COLLECTION</a></li>
        
        <li id=""><a target="_self" href="tools.html">TOOLS</a></li>
        
        <li id=""><a target="_blank" href="about.html">ABOUT</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Time渐行渐远</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
       
       <li><a href="index.html">HOME</a></li>
    <li><a href="archives.html">Archives</a></li>
    <li><a href="about.html">ABOUT</a></li>

    <li><label>Categories</label></li>

        
            <li><a href="BigData.html">BigData</a></li>
        
            <li><a href="Python.html">Python</a></li>
        
            <li><a href="Linux.html">Linux</a></li>
        
            <li><a href="Life.html">Life</a></li>
        
            <li><a href="Spark.html">Spark</a></li>
        
            <li><a href="Hive.html">Hive</a></li>
        
            <li><a href="Yarn.html">Yarn</a></li>
        
            <li><a href="Scala.html">Scala</a></li>
        
            <li><a href="VPS.html">VPS</a></li>
        
            <li><a href="MachineLearning.html">MachineLearning</a></li>
        
            <li><a href="Writer.html">Writer</a></li>
        
            <li><a href="Shell.html">Shell</a></li>
        
            <li><a href="Algorithm.html">Algorithm</a></li>
        
            <li><a href="Mac.html">Mac</a></li>
        
            <li><a href="Presto.html">Presto</a></li>
        
            <li><a href="Mysql.html">Mysql</a></li>
        
            <li><a href="Maven.html">Maven</a></li>
        
            <li><a href="Kafka.html">Kafka</a></li>
        
            <li><a href="Java.html">Java</a></li>
        
            <li><a href="DevTools.html">DevTools</a></li>
        
            <li><a href="Hbase.html">Hbase</a></li>
        
            <li><a href="ELK.html">ELK</a></li>
        
            <li><a href="Druid.html">Druid</a></li>
        
            <li><a href="Docker.html">Docker</a></li>
        
            <li><a href="DesignPattern.html">DesignPattern</a></li>
        
            <li><a href="Computer.html">Computer</a></li>
        
            <li><a href="Redis.html">Redis</a></li>
        
            <li><a href="Zookeeper.html">Zookeeper</a></li>
        
            <li><a href="BlockChain.html">BlockChain</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>机器学习实战之决策树</h1>
     
        <div class="read-more clearfix">
          <span class="date">2016/11/9</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='MachineLearning.html'>MachineLearning</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <h1 id="toc_0">什么是决策树</h1>

<h2 id="toc_1">决策树的概念</h2>

<span id="more"></span><!-- more -->

<p>如图1:<br/>
<img src="media/15198664916272/decisitionTreeBasic.png" alt="decisitionTreeBasi"/></p>

<p>图1中就是一个决策树,长方形代表判断模块,椭圆形代表终止模块,表示已经得出结论,可以终止运行.从判断模块引出的左右箭头称作分支.<br/>
它可以到达另一个判断模块或者终止模块.</p>

<h2 id="toc_2">决策树的特点</h2>

<ul>
<li>优点:计算复杂度不高,输出结果易于理解,对中间值的缺失不敏感,可以处理不相关特征数据<br/></li>
<li>缺点:可能会产生过度匹配问题<br/></li>
<li>使用数据类型:数值型和标称型<br/></li>
</ul>

<h2 id="toc_3">决策树的一般流程</h2>

<ul>
<li>收集数据:可以使用任何方法<br/></li>
<li>准备数据:树构造算法只适用于标称型数据,因此数值型数据必须离散化<br/></li>
<li>分析数据:可以使用任何方法<br/></li>
</ul>

<p>构造树完成之后,我们应该检查图形是否符合预期</p>

<ul>
<li>训练算法:构造树的数据结构</li>
<li>测试算法:使用经验树计算错误率</li>
<li>使用算法:此步骤可以适用于任何监督学习算法</li>
</ul>

<h1 id="toc_4">如何构建决策树</h1>

<blockquote>
<p>接下来我们将学习如何从一堆原始数据中构造决策树</p>
</blockquote>

<h2 id="toc_5">计算信息增益来度量信息</h2>

<blockquote>
<p>我们需要解决的第一个问题就是,当前数据集上哪个特征在划分数据分类时起决定性作用.为了找到决定性的特征,划分出最好的结果,<br/>
我们必须评估每个特征.</p>
</blockquote>

<h3 id="toc_6">如何对数据进行评估</h3>

<p>划分数据集的最大原则是:将无序的数据变得更加有序.<br/>
因此,我们可以在划分数据前后使用信息论量化度量信息的内容.在划分数据集之前之后信息发生的变化称为<strong>信息增益</strong>,<br/>
知道如何计算信息增益,我们就可以计算每个特征划分数据集获得的信息增益,或得信息增益最高的特征就是最好的选择.</p>

<p><strong>集合信息的度量方式称为香农熵或者简称熵(这个名字来源于信息论之父克劳德-香农)</strong></p>

<p>熵定义为信息的期望值,在明晰这个概念之前,我们必须知道信息的定义.<br/>
信息的定义:如果待分类的事物可能划分在多个分类之中,则符号Xi的信息定义为</p>

<p><img src="media/15198664916272/xinxi.png" alt="xinxi"/></p>

<p>其中P(Xi)是选择该分类的概率.</p>

<p>为了计算熵,我们需要计算所有类别所有可能值包含的信息期望值,通过下面的公式得到:<br/>
<img src="media/15198664916272/shang.png" alt="shang"/></p>

<p>其中n类是分类的数目</p>

<h3 id="toc_7">计算给定数据集的香农熵</h3>

<blockquote>
<p>利用上面的公式,对数据集求香农熵,得出信息增益,度量信息量</p>
</blockquote>

<p>1.计算有多少行<br/>
2.对每一行的最后一个label进行统计.(用一个字典可以方便的解决这个问题,key是label,value是次数)<br/>
3.对每个label求概率<br/>
4.运用熵公式求值</p>

<p>先创建一个数据集</p>

<pre><code>def createDataSet():
    dataSet=[[1,1,&#39;maybe&#39;],
             [1,1,&#39;yes&#39;],
             [1,0,&#39;no&#39;],
             [0,1,&#39;no&#39;],
             [0,1,&#39;no&#39;]]
    labels=[&#39;no surfacing&#39;,&#39;flippers&#39;]
    return dataSet,labels
</code></pre>

<p>步入正题</p>

<pre><code>from math import log

def calcShannonEnt(dataSet):
    numEntries=len(dataSet)
    labelCounts={}
    for featVec in dataSet:
        currentLable=featVec[-1]
        if currentLable not in labelCounts.keys():
            labelCounts[currentLable]=0
        labelCounts[currentLable]+=1
    shannonEnt=0.0
    for key in labelCounts:
        prob=float(labelCounts[key])/numEntries
        shannonEnt-=prob*log(prob,2)
    return shannonEnt
</code></pre>

<p><strong>注意</strong>:求出的熵值越高,表示混合的数据也越多.也就是这个数据集中的分类也越多.</p>

<h2 id="toc_8">合理划分数据集</h2>

<blockquote>
<p>得到熵之后,我们就可以按照获取最大信息增益的方法划分数据集.</p>
</blockquote>

<p>我们将对每个特征划分数据集的结果计算一次信息熵.然后判断按照哪个特征划分数据集是最好的划分方式.<br/>
也就是对划分后的数据集求信息熵,熵值越小,表示数据划分的越好.</p>

<h3 id="toc_9">划分数据集</h3>

<pre><code>def splitDataSet(dataSet,axis,values):
    retDataSet=[]
    for featVec in dataSet:
        if featVec[axis]==values:
            reducedFeatVec=featVec[:axis]
            reducedFeatVec.extend(featVec[axis+1:])
            retDataSet.append(reducedFeatVec)
    return retDataSet
</code></pre>

<p>说明:该代码需要三个参数<br/>
+ 参数1:数据集<br/>
+ 参数2:axis是按照第几个特征划分<br/>
+ 参数3:values是该特征的值</p>

<p>我们要遍历数据集中的每个元素,一旦发现符合要求的值,则将其添加到新创建的列表中.<br/>
这里要注意python中,对列表操作的两个方法的不同之处.extend和append</p>

<h3 id="toc_10">选择最好的数据集划分方式</h3>

<blockquote>
<p>接下来我们遍历整个数据集,循环计算香农熵和splitDataSet()函数,找到最好的特征划分方式.<br/>
熵计算将会告诉我们如何划分数据集是最好的数据组织方式.</p>
</blockquote>

<p>数据需要满足的要求:</p>

<ul>
<li>1.数据必须是一种由列表元素组成的列表,而且所有的列表元素都要具有相同的数据长度.</li>
<li>2.数据的最后一列或者每个实例的最后一个元素是当前实例的类别标签.</li>
</ul>

<pre><code>def chooseBestFeatureToSplit(dataSet):
    # 返回一共有几个特征
    numFeatures=len(dataSet[0])-1
    baseEntropy=calcShannonEnt(dataSet)
    bestInfoGain=0.0
    bestFeature=-1
    # 遍历特征,一个特征一个特征的来处理
    for i in range(numFeatures):
        featList=[example[i] for example in dataSet]
        print &quot;featList \n&quot;,featList
        uniqueVals=set(featList)
        newEntropy=0.0

        # 对该特征的所有可能取值的方式进行划分,然后求信息熵,最后把该特征的信息增益求出来
        for value in uniqueVals:
            # 对每个特征的不同值进行划分数据
            subDataSet=splitDataSet(dataSet,i,value)
            prob=len(subDataSet)/float(len(dataSet))
            newEntropy+=prob*calcShannonEnt(subDataSet)
        infoGain=baseEntropy-newEntropy
        # 信息增益越大,说明用该特征划分的数据集计算出的信息熵越小,也就是划分的越好.
        # 在此跟上一次的划分进行比较,得出最合适的特质
        if (infoGain&gt;bestInfoGain):
            bestInfoGain=infoGain
            bestFeature=i
    return bestFeature
</code></pre>

<h2 id="toc_11">递归构建决策树</h2>

<blockquote>
<p>有了上面的准备后,我们要开始把上面的方法组合起来,构建决策树了.</p>
</blockquote>

<p>目前我们已经知道了从数据集构建决策树算法所需要的子功能模块,其工作原理如下:<br/>
得到原始数据集,然后基于最好的属性值划分数据集,由于特征值可能多于两个,因此可能存在大于两个分支的数据集划分.<br/>
第一次划分后,数据将被向下传递到树分支的下一个节点,在这个节点上,我们可以再次划分数据.因此我们可以采用递归的原则处理数据集.<br/>
递归结束的条件是:<br/>
程序遍历完所有划分数据集的属性,或者每个分支下的所有实例都具有相同的分类,则得到一个叶子节点或者终止块.<br/>
<strong>任何到达叶子节点的数据必然属于叶子节点的分类</strong></p>

<p><img src="media/15198664916272/tree.png" alt="tree"/></p>

<pre><code>def majorityCnt(classList):
    classCount={}
    for vote in classList:
        if vote not in classCount.keys():classCount[vote]=0
        classCount[vote]+=1
    sortedClassCount=sorted(classCount.iteritems(),key=operator.itemgetter(1),reverse=True)
    return sortedClassCount[0][0]

def createTree(dataSet,labels):
    # 获取该数据集的所有label,存放到一个列表中
    classList=[example[-1] for example in dataSet]
    # 判断:如果在这个数据集的列表中,第一个元素的个数和这个列表的元素个数相等.说明这个数据集已经划分完全了.
    if classList.count(classList[0])==len(classList):
        return classList[0]
    if len(dataSet[0])==1:
        return majorityCnt(classList)
    # 获取最合适的分类特征
    bestFeat=chooseBestFeatureToSplit(dataSet)
    #
    bestFeatLabel=labels[bestFeat]
    myTree={bestFeatLabel:{}}
    # 得到列表包含的所有属性值
    del(labels[bestFeat])
    featValues=[example[bestFeat] for example in dataSet]
    uniqueVals=set(featValues)
    for value in uniqueVals:
        subLabels=labels[:]
        myTree[bestFeatLabel][value]=createTree(splitDataSet(dataSet,bestFeat,value),subLabels)
    return myTree
</code></pre>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15198714756091.html" 
          title="Previous Post: 浅谈逻辑">&laquo; 浅谈逻辑</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15198747727059.html" 
          title="Next Post: 修改 mysql 用户密码">修改 mysql 用户密码 &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="https://s.gravatar.com/avatar/2d9bdeec5ad2754d8a47063df1346ee8?s=80" /></div>
            
                <h1>Time渐行渐远</h1>
                <div class="site-des">Coding Changing The World</div>
                <div class="social">







<a target="_blank" class="weibo" href="http://weibo.com/hswnice" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/HswTime" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/Timehsw" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:hsw_v5@163.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="BigData.html"><strong>BigData</strong></a>
        
            <a href="Python.html"><strong>Python</strong></a>
        
            <a href="Linux.html"><strong>Linux</strong></a>
        
            <a href="Life.html"><strong>Life</strong></a>
        
            <a href="Spark.html"><strong>Spark</strong></a>
        
            <a href="Hive.html"><strong>Hive</strong></a>
        
            <a href="Yarn.html"><strong>Yarn</strong></a>
        
            <a href="Scala.html"><strong>Scala</strong></a>
        
            <a href="VPS.html"><strong>VPS</strong></a>
        
            <a href="MachineLearning.html"><strong>MachineLearning</strong></a>
        
            <a href="Writer.html"><strong>Writer</strong></a>
        
            <a href="Shell.html"><strong>Shell</strong></a>
        
            <a href="Algorithm.html"><strong>Algorithm</strong></a>
        
            <a href="Mac.html"><strong>Mac</strong></a>
        
            <a href="Presto.html"><strong>Presto</strong></a>
        
            <a href="Mysql.html"><strong>Mysql</strong></a>
        
            <a href="Maven.html"><strong>Maven</strong></a>
        
            <a href="Kafka.html"><strong>Kafka</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
        
            <a href="DevTools.html"><strong>DevTools</strong></a>
        
            <a href="Hbase.html"><strong>Hbase</strong></a>
        
            <a href="ELK.html"><strong>ELK</strong></a>
        
            <a href="Druid.html"><strong>Druid</strong></a>
        
            <a href="Docker.html"><strong>Docker</strong></a>
        
            <a href="DesignPattern.html"><strong>DesignPattern</strong></a>
        
            <a href="Computer.html"><strong>Computer</strong></a>
        
            <a href="Redis.html"><strong>Redis</strong></a>
        
            <a href="Zookeeper.html"><strong>Zookeeper</strong></a>
        
            <a href="BlockChain.html"><strong>BlockChain</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15255701784620.html">集成学习</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15255685118456.html">决策树</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15198753668603.html">逻辑回归</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15248143200628.html">回归算法</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15242825563762.html">python-matplotlib画图中文显示不出来</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    <script src="asset/chart/all-min.js"></script><script type="text/javascript">$(function(){    var mwebii=0;    var mwebChartEleId = 'mweb-chart-ele-';    $('pre>code').each(function(){        mwebii++;        var eleiid = mwebChartEleId+mwebii;        if($(this).hasClass('language-sequence')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = Diagram.parse($(this).text());            diagram.drawSVG(eleiid,{theme: 'simple'});        }else if($(this).hasClass('language-flow')){            var ele = $(this).addClass('nohighlight').parent();            $('<div id="'+eleiid+'"></div>').insertAfter(ele);            ele.hide();            var diagram = flowchart.parse($(this).text());            diagram.drawSVG(eleiid);        }    });});</script>
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2a025c7742b90ad62b1e767e1b7f2f29";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>
