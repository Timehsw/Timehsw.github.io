<!doctype html>
<html class="no-js" lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>
    
  深入理解Java虚拟机之JDK命令行工具(一) - Time渐行渐远
  
  </title>
  
  
  <link href="atom.xml" rel="alternate" title="Time渐行渐远" type="application/atom+xml">
    <link rel="stylesheet" href="asset/css/foundation.min.css" />
    <link rel="stylesheet" href="asset/css/docs.css" />
    <script src="asset/js/vendor/modernizr.js"></script>
    <script src="asset/js/vendor/jquery.js"></script>
  <script src="asset/highlightjs/highlight.pack.js"></script>
  <link href="asset/highlightjs/styles/github.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script>hljs.initHighlightingOnLoad();</script>
<script type="text/javascript">
  function before_search(){
    var searchVal = 'site:dmlcoding.com ' + document.getElementById('search_input').value;
    document.getElementById('search_q').value = searchVal;
    return true;
  }
</script>
  </head>
  <body class="antialiased hide-extras">
    
    <div class="marketing off-canvas-wrap" data-offcanvas>
      <div class="inner-wrap">


<nav class="top-bar docs-bar hide-for-small" data-topbar>


  <section class="top-bar-section">
  <div class="row">
      <div style="position: relative;width:100%;"><div style="position: absolute; width:100%;">
        <ul id="main-menu" class="left">
        
        <li id=""><a target="_self" href="index.html">Home</a></li>
        
        <li id=""><a target="_self" href="archives.html">Archives</a></li>
        
        <li id=""><a target="_self" href="collections.html">COLLECTION</a></li>
        
        <li id=""><a target="_self" href="tools.html">TOOLS</a></li>
        
        <li id=""><a target="_blank" href="about.html">ABOUT</a></li>
        
        </ul>

        <ul class="right" id="search-wrap">
          <li>
<form target="_blank" onsubmit="return before_search();" action="http://google.com/search" method="get">
    <input type="hidden" id="search_q" name="q" value="" />
    <input tabindex="1" type="search" id="search_input"  placeholder="Search"/>
</form>
</li>
          </ul>
      </div></div>
  </div>
  </section>

</nav>

        <nav class="tab-bar show-for-small">
  <a href="javascript:void(0)" class="left-off-canvas-toggle menu-icon">
    <span> &nbsp; Time渐行渐远</span>
  </a>
</nav>

<aside class="left-off-canvas-menu">
      <ul class="off-canvas-list">
        
        <li><a target="_self" href="index.html">Home</a></li>
        
        <li><a target="_self" href="archives.html">Archives</a></li>
        
        <li><a target="_self" href="collections.html">COLLECTION</a></li>
        
        <li><a target="_self" href="tools.html">TOOLS</a></li>
        
        <li><a target="_blank" href="about.html">ABOUT</a></li>
        

    <li><label>Categories</label></li>

        
            <li><a href="BigData.html">BigData</a></li>
        
            <li><a href="Python.html">Python</a></li>
        
            <li><a href="Linux.html">Linux</a></li>
        
            <li><a href="Life.html">Life</a></li>
        
            <li><a href="Spark.html">Spark</a></li>
        
            <li><a href="Hive.html">Hive</a></li>
        
            <li><a href="Yarn.html">Yarn</a></li>
        
            <li><a href="Scala.html">Scala</a></li>
        
            <li><a href="VPS.html">VPS</a></li>
        
            <li><a href="MachineLearning.html">MachineLearning</a></li>
        
            <li><a href="Writer.html">Writer</a></li>
        
            <li><a href="Shell.html">Shell</a></li>
        
            <li><a href="Algorithm.html">Algorithm</a></li>
        
            <li><a href="Mac.html">Mac</a></li>
        
            <li><a href="Presto.html">Presto</a></li>
        
            <li><a href="Mysql.html">Mysql</a></li>
        
            <li><a href="Maven.html">Maven</a></li>
        
            <li><a href="Kafka.html">Kafka</a></li>
        
            <li><a href="Java.html">Java</a></li>
        
            <li><a href="DevTools.html">DevTools</a></li>
        
            <li><a href="Hbase.html">Hbase</a></li>
        
            <li><a href="ELK.html">ELK</a></li>
        
            <li><a href="Druid.html">Druid</a></li>
        
            <li><a href="Docker.html">Docker</a></li>
        
            <li><a href="DesignPattern.html">DesignPattern</a></li>
        
            <li><a href="Computer.html">Computer</a></li>
        
            <li><a href="Redis.html">Redis</a></li>
        
            <li><a href="Zookeeper.html">Zookeeper</a></li>
        
            <li><a href="BlockChain.html">BlockChain</a></li>
         

      </ul>
    </aside>

<a class="exit-off-canvas" href="#"></a>


        <section id="main-content" role="main" class="scroll-container">
        
       

 <script type="text/javascript">
  $(function(){
    $('#menu_item_index').addClass('is_active');
  });
</script>
<div class="row">
  <div class="large-8 medium-8 columns">
      <div class="markdown-body article-wrap">
       <div class="article">
          
          <h1>深入理解Java虚拟机之JDK命令行工具(一)</h1>
     
        <div class="read-more clearfix">
          <span class="date">2017/8/2</span>

          <span>posted in&nbsp;</span> 
          
              <span class="posted-in"><a href='Java.html'>Java</a></span>
           
         
          <span class="comments">
            

            
          </span>

        </div>
      </div><!-- article -->

      <div class="article-content">
      <p>JDK命令行工具,是java提供给我们的礼物,我们怎么能拒绝他们的馈赠呢</p>

<span id="more"></span><!-- more -->

<h1 id="toc_0">jps:虚拟机进程状况工具</h1>

<blockquote>
<p>jps(JVM Process Status)<br/>
可以列出正在运行的虚拟机进程,,并显示虚拟机执行主类(main函数的名称),以及这些进程的本地虚拟机的唯一ID(LVMID,Local Virtual Machine Identifier)<br/>
对于本地虚拟机进程来说,LVMID与操作系统的进程ID(PID,Process Identifier)是一致的</p>
</blockquote>

<h2 id="toc_1">jps命令格式</h2>

<pre class="line-numbers"><code class="language-text">jps [options] [hostid]
</code></pre>

<h2 id="toc_2">jps工具主要选项</h2>

<table>
<thead>
<tr>
<th style="text-align: center">选项</th>
<th style="text-align: left">作用</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">-q</td>
<td style="text-align: left">只输出LVMID,省略主类的名称</td>
</tr>
<tr>
<td style="text-align: center">-m</td>
<td style="text-align: left">输出虚拟机进程启动时传递给主类main()函数的参数</td>
</tr>
<tr>
<td style="text-align: center">-l</td>
<td style="text-align: left">输出主类的全名,如果进程执行的是jar包,输出jar路径</td>
</tr>
<tr>
<td style="text-align: center">-v</td>
<td style="text-align: left">输出虚拟机进程启动时JVM参数</td>
</tr>
</tbody>
</table>

<h2 id="toc_3">jps命令样例1</h2>

<pre class="line-numbers"><code class="language-text">[hadoop@U006 ~]$ jps -l
3183 sun.tools.jps.Jps
17831 org.apache.spark.executor.CoarseGrainedExecutorBackend
10004 org.apache.spark.deploy.worker.Worker
17659 org.apache.spark.deploy.SparkSubmit
10254 org.apache.spark.deploy.worker.Worker
9830 org.apache.spark.deploy.master.Master
</code></pre>

<h1 id="toc_4">jstat:虚拟机统计信息监视工具</h1>

<blockquote>
<p>jstat(JVM Statistics Monitoring Tool)<br/>
jstat是用于监视虚拟机各种运行状态信息的命令行工具<br/>
它可以显示本地或远程虚拟机进程中的类装载,内存,垃圾收集,JIT编译等运行数据.<br/>
在没有GUI图形界面,只提供了纯文本控制台环境的服务器上,它将是运行期定位虚拟机性能问题的首选工具</p>
</blockquote>

<h2 id="toc_5">jstat命令格式</h2>

<pre class="line-numbers"><code class="language-text">jstat [option vmid [interval[s|ms] [count]]]
</code></pre>

<p><strong>注意</strong>:</p>

<ul>
<li>对于命令中的VMID与LVMID需要特别说明一下:如果是本地虚拟机进程,VMID与LVMID是一致的.</li>
<li>如何是远程虚拟机进程,那VMID的格式应当是:<code>[protocal:][//]lvmid[@hostname[:port]/servername]</code></li>
<li>参数interval和count代表查询间隔和次数.如果省略这两个参数,说明只查询一次.</li>
</ul>

<p>假设需要每250毫秒查询一次进程2764垃圾收集的状况,一共查询20次,那么命令应该是:</p>

<pre class="line-numbers"><code class="language-text">jstat -gc 2764 250 20
</code></pre>

<p>每2毫秒查询10次spark进程的垃圾收集状况:</p>

<pre class="line-numbers"><code class="language-text">[hadoop@U006 ~]$ jstat -gc 17659 2 10
 S0C    S1C    S0U    S1U      EC       EU        OC         OU       PC     PU    YGC     YGCT    FGC    FGCT     GCT
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
349184.0 349184.0  0.0    0.0   2098176.0 954275.3 5592576.0   246723.4  116224.0 115802.6     52    5.099  48     18.956   24.056
</code></pre>

<h2 id="toc_6">jstat工具主要选项</h2>

<table>
<thead>
<tr>
<th style="text-align: center">选项</th>
<th style="text-align: left">作用</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">-class</td>
<td style="text-align: left">监视类装载,卸载数据,总空间及类装载所耗费的时间</td>
</tr>
<tr>
<td style="text-align: center">-gc</td>
<td style="text-align: left">监视Java堆状况,包括Eden区,2个survivor区,老年代,永久代等的容量,已用空间,GC时间合计等信息</td>
</tr>
<tr>
<td style="text-align: center">-gccapacity</td>
<td style="text-align: left">监视内容与-gc基本相同,但输出主要关注Java堆各个区域使用到的最大和最小空间</td>
</tr>
<tr>
<td style="text-align: center">-gcutil</td>
<td style="text-align: left">监视内容与-gc基本相同,但输出主要关注已使用空间占总空间的百分比</td>
</tr>
<tr>
<td style="text-align: center">...</td>
<td style="text-align: left">...</td>
</tr>
</tbody>
</table>

<h2 id="toc_7">jstat执行样例</h2>

<pre class="line-numbers"><code class="language-text">hadoop@U006 ~]$ jstat -gcutil 17659
  S0     S1     E      O      P     YGC     YGCT    FGC    FGCT     GCT
  0.00   0.00  37.59   4.41  99.68     77    7.439    73   27.473   34.912
</code></pre>

<p>查询结果表明:<br/>
这个进程的</p>

<ul>
<li>新生代Eden区(E,表示Eden)使用了37.59%的空间.</li>
<li>两个Survivor区(S0,S1,表示Survivor0,Survivor1)里面都是空的.</li>
<li>老年代(O,表示Old)和永久代(P,表示Permanent)则分别使用了4.41%和99.68%的空间.</li>
<li>程序运行以来共发生Minor GC(YGC,表示Young GC)77次,总耗时7.439秒.</li>
<li>发生Full GC(FGC,表示Full GC)73次,Full GC总耗时(FGCT,表示Full GC Time)为27.473秒.</li>
<li>所有GC总耗时(GCT,表示GC Time)为34.912秒.</li>
</ul>

<p><strong>总结</strong>:使用jstat工具在纯文本状态下监视虚拟机状态的变化,虽然没有一些可视化监控工具来得直观.但与我而言,更显极客本色.</p>

<h1 id="toc_8">jinfo:Java配置信息工具</h1>

<blockquote>
<p>jinso(Configuration Info For Java)<br/>
jinfo的作用是实时地查看和调整虚拟机的各项参数</p>
</blockquote>

<h2 id="toc_9">jinfo命令格式</h2>

<pre class="line-numbers"><code class="language-text">jinfo [option] pid
</code></pre>

<h2 id="toc_10">使用方式</h2>

<p>前面解释过jps的-v选项.这个可以查看虚拟机启动时显示指定的参数列表,比如</p>

<pre class="line-numbers"><code class="language-text">[hadoop@U006 ~]$ jps -v
17831 CoarseGrainedExecutorBackend -Xms4096M -Xmx4096M -Dspark.driver.port=42195 -XX:MaxPermSize=256m
5146 Jps -Dapplication.home=/usr/java/jdk1.7.0_71 -Xms8m
10004 Worker -Xms1g -Xmx1g -XX:MaxPermSize=256m
17659 SparkSubmit -Xms8g -Xmx8g -XX:MaxPermSize=256m
10254 Worker -Xms1g -Xmx1g -XX:MaxPermSize=256m
9830 Master -Xms1g -Xmx1g -XX:MaxPermSize=256m
</code></pre>

<p>但如果想知道未被显示指定的参数的系统默认值,除了查找资料,还可以使用这里的<code>jinfo的-flag</code>选项进行查询了.</p>

<p>比如查询CMSInitiatingOccupancyFraction参数值:</p>

<pre class="line-numbers"><code class="language-text">[hadoop@U006 ~]$ jinfo -flag CMSInitiatingOccupancyFraction 17659
-XX:CMSInitiatingOccupancyFraction=-1
</code></pre>

<h1 id="toc_11">jmap:Java内存映像工具</h1>

<blockquote>
<p>jmap(Memory Map For Java)<br/>
jmap是用于生成堆转储快照(一般称为Heapdump或dump文件).</p>
</blockquote>

<h1 id="toc_12">jstack:Java堆栈跟踪工具</h1>

<blockquote>
<p>jstack(Stack Trace for Java)<br/>
jstack命令用于生成虚拟机当前时刻的线程快照(一般称为threaddump或javacore文件)</p>
</blockquote>

<p><strong>线程快照:</strong> 就是当前虚拟机内每一条线程正在执行的方法堆栈的集合,生成线程快照的主要目的是 <em>定位线程出现长时间停顿的原因</em>.</p>

<p>线程长时间停顿的常见原因:<br/>
1.线程间死锁,死循环<br/>
2.请求外部资源导致的长时间等待<br/>
3.等等</p>

<p>线程出现停顿的时候通过jstack来查看各个线程的调用堆栈,就可以知道没有响应的线程到底在后台做些什么事情,或者等待着什么资源.</p>

<h2 id="toc_13">jstack命令格式</h2>

<pre class="line-numbers"><code class="language-text">jstack [option] vmid
</code></pre>

<h2 id="toc_14">jstack工具的主要选项</h2>

<table>
<thead>
<tr>
<th style="text-align: center">选项</th>
<th style="text-align: left">作用</th>
</tr>
</thead>

<tbody>
<tr>
<td style="text-align: center">-F</td>
<td style="text-align: left">当正常输出的请求不被响应时,强制输出线程堆栈</td>
</tr>
<tr>
<td style="text-align: center">-l</td>
<td style="text-align: left">除堆栈外,显示关于锁的附加信息</td>
</tr>
<tr>
<td style="text-align: center">-m</td>
<td style="text-align: left">如果调用到本地方法的话,可以显示C/C++的堆栈</td>
</tr>
</tbody>
</table>


    

      </div>

      <div class="row">
        <div class="large-6 columns">
        <p class="text-left" style="padding:15px 0px;">
      
          <a href="15198760861207.html" 
          title="Previous Post: 深入理解Java虚拟机之Java内存区域与内存溢出">&laquo; 深入理解Java虚拟机之Java内存区域与内存溢出</a>
      
        </p>
        </div>
        <div class="large-6 columns">
      <p class="text-right" style="padding:15px 0px;">
      
          <a  href="15213431815968.html" 
          title="Next Post: python-matplotlib note">python-matplotlib note &raquo;</a>
      
      </p>
        </div>
      </div>
      <div class="comments-wrap">
        <div class="share-comments">
          <div id="disqus_thread"></div>
<script>

/**
*  RECOMMENDED CONFIGURATION VARIABLES: EDIT AND UNCOMMENT THE SECTION BELOW TO INSERT DYNAMIC VALUES FROM YOUR PLATFORM OR CMS.
*  LEARN WHY DEFINING THESE VARIABLES IS IMPORTANT: https://disqus.com/admin/universalcode/#configuration-variables*/
/*
var disqus_config = function () {
this.page.url = PAGE_URL;  // Replace PAGE_URL with your page's canonical URL variable
this.page.identifier = PAGE_IDENTIFIER; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
};
*/
(function() { // DON'T EDIT BELOW THIS LINE
var d = document, s = d.createElement('script');
s.src = 'https://dmlcoding.disqus.com/embed.js';
s.setAttribute('data-timestamp', +new Date());
(d.head || d.body).appendChild(s);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
                            

          

          
        </div>
      </div>
    </div><!-- article-wrap -->
  </div><!-- large 8 -->




 <div class="large-4 medium-4 columns">
  <div class="hide-for-small">
    <div id="sidebar" class="sidebar">
          <div id="site-info" class="site-info">
            
                <div class="site-a-logo"><img src="https://s.gravatar.com/avatar/2d9bdeec5ad2754d8a47063df1346ee8?s=80" /></div>
            
                <h1>Time渐行渐远</h1>
                <div class="site-des">Coding Changing The World</div>
                <div class="social">







<a target="_blank" class="weibo" href="http://weibo.com/hswnice" title="weibo">Weibo</a>
<a target="_blank" class="twitter" target="_blank" href="https://twitter.com/HswTime" title="Twitter">Twitter</a>
<a target="_blank" class="github" target="_blank" href="https://github.com/Timehsw" title="GitHub">GitHub</a>
<a target="_blank" class="email" href="mailto:hswv5@foxmail.com" title="Email">Email</a>
  <a target="_blank" class="rss" href="atom.xml" title="RSS">RSS</a>
                
              	 </div>
          	</div>

             

              <div id="site-categories" class="side-item ">
                <div class="side-header">
                  <h2>Categories</h2>
                </div>
                <div class="side-content">

      	<p class="cat-list">
        
            <a href="BigData.html"><strong>BigData</strong></a>
        
            <a href="Python.html"><strong>Python</strong></a>
        
            <a href="Linux.html"><strong>Linux</strong></a>
        
            <a href="Life.html"><strong>Life</strong></a>
        
            <a href="Spark.html"><strong>Spark</strong></a>
        
            <a href="Hive.html"><strong>Hive</strong></a>
        
            <a href="Yarn.html"><strong>Yarn</strong></a>
        
            <a href="Scala.html"><strong>Scala</strong></a>
        
            <a href="VPS.html"><strong>VPS</strong></a>
        
            <a href="MachineLearning.html"><strong>MachineLearning</strong></a>
        
            <a href="Writer.html"><strong>Writer</strong></a>
        
            <a href="Shell.html"><strong>Shell</strong></a>
        
            <a href="Algorithm.html"><strong>Algorithm</strong></a>
        
            <a href="Mac.html"><strong>Mac</strong></a>
        
            <a href="Presto.html"><strong>Presto</strong></a>
        
            <a href="Mysql.html"><strong>Mysql</strong></a>
        
            <a href="Maven.html"><strong>Maven</strong></a>
        
            <a href="Kafka.html"><strong>Kafka</strong></a>
        
            <a href="Java.html"><strong>Java</strong></a>
        
            <a href="DevTools.html"><strong>DevTools</strong></a>
        
            <a href="Hbase.html"><strong>Hbase</strong></a>
        
            <a href="ELK.html"><strong>ELK</strong></a>
        
            <a href="Druid.html"><strong>Druid</strong></a>
        
            <a href="Docker.html"><strong>Docker</strong></a>
        
            <a href="DesignPattern.html"><strong>DesignPattern</strong></a>
        
            <a href="Computer.html"><strong>Computer</strong></a>
        
            <a href="Redis.html"><strong>Redis</strong></a>
        
            <a href="Zookeeper.html"><strong>Zookeeper</strong></a>
        
            <a href="BlockChain.html"><strong>BlockChain</strong></a>
         
        </p>


                </div>
              </div>

              <div id="site-categories" class="side-item">
                <div class="side-header">
                  <h2>Recent Posts</h2>
                </div>
                <div class="side-content">
                <ul class="posts-list">
	      
		      
			      <li class="post">
			        <a href="15423390877662.html">Pandas 中map, applymap and apply的区别</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15420931314995.html">Objective vs. Cost vs. Loss vs. Error Function</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15402913817590.html">将python生成的base64图片,在浏览器上展示出来</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15398508250689.html">Isolation Forest</a>
			      </li>
		     
		  
		      
			      <li class="post">
			        <a href="15396891344806.html">聚类算法评估指标</a>
			      </li>
		     
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		  
		      
		   
		  		</ul>
                </div>
              </div>
        </div><!-- sidebar -->
      </div><!-- hide for small -->
</div><!-- large 4 -->

</div><!-- row -->

 <div class="page-bottom clearfix">
  <div class="row">
   <p class="copyright">Copyright &copy; 2015
Powered by <a target="_blank" href="http://www.mweb.im">MWeb</a>,&nbsp; 
Theme used <a target="_blank" href="http://github.com">GitHub CSS</a>.</p>
  </div>
</div>

        </section>
      </div>
    </div>

  
    

    <script src="asset/js/foundation.min.js"></script>
    <script>
      $(document).foundation();
      function fixSidebarHeight(){
        var w1 = $('.markdown-body').height();
          var w2 = $('#sidebar').height();
          if (w1 > w2) { $('#sidebar').height(w1); };
      }
      $(function(){
        fixSidebarHeight();
      })
      $(window).load(function(){
          fixSidebarHeight();
      });
     
    </script>

    
<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({TeX: { equationNumbers: { autoNumber: "AMS" } }});</script>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?2a025c7742b90ad62b1e767e1b7f2f29";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>


  </body>
</html>
